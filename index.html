<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice Generator</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f7fbff;
      padding: 2rem;
    }

    .container {
      max-width: 1400px;
      margin: auto;
    }

    .form-section {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .invoice-section {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .remove-btn {
      margin-top: 0.25rem;
      height: 38px;
      font-size: 0.8rem;
      padding: 0 10px;
    }

    .invoice-preview {
      page-break-before: always;
    }

    @media print {
      body {
        margin: 0;
      }

      .no-print {
        display: none;
      }

      .invoice-section {
        margin: 0;
        box-shadow: none;
        page-break-inside: avoid;
        width: 100vw;
        height: 100vh;
        padding: 40px;
      }
    }

    h4.business-name {
      font-size: 1.6rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <!-- Form Section -->
      <div class="col-md-6 form-section">
        <h5>Sender Information</h5>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label>Your Name:</label>
            <input type="text" class="form-control" id="senderName">
          </div>
          <div class="form-group col-md-6">
            <label>Your Number:</label>
            <input type="text" class="form-control" id="senderNumber">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label>Your Email:</label>
            <input type="email" class="form-control" id="senderEmail">
          </div>
          <div class="form-group col-md-6">
            <label>Your ABN:</label>
            <input type="text" class="form-control" id="senderABN">
          </div>
        </div>

        <h5>Invoice Details</h5>
        <div class="form-group">
          <label>Business Name:</label>
          <input type="text" class="form-control" id="businessName">
        </div>
        <div class="form-group">
          <label>ABN:</label>
          <input type="text" class="form-control" id="businessABN">
        </div>
        <div class="form-group">
          <label>Phone:</label>
          <input type="text" class="form-control" id="businessPhone">
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input type="email" class="form-control" id="businessEmail">
        </div>
        <div class="form-group">
          <label>Invoice Number:</label>
          <input type="text" class="form-control" id="invoiceNumber">
        </div>
        <div class="form-group">
          <label>Invoice Date:</label>
          <input type="date" class="form-control" id="invoiceDate">
        </div>

        <h5>Services/Products</h5>
        <div id="services"></div>
        <div class="form-row">
          <div class="form-group col">
            <input type="text" class="form-control" placeholder="Service" id="serviceName">
          </div>
          <div class="form-group col">
            <input type="text" class="form-control" placeholder="Description" id="serviceDescription">
          </div>
          <div class="form-group col">
            <input type="number" class="form-control" placeholder="Total" id="serviceTotal">
          </div>
          <div class="form-group col-auto">
            <button class="btn btn-primary" onclick="addService()">Add Service</button>
          </div>
        </div>
      </div>

      <!-- Invoice Preview -->
      <div class="col-md-5 invoice-section ml-md-3" id="invoicePreview">
        <div>
          <p><strong>From:</strong><br>
            <span id="previewSenderName"></span><br>
            Phone: <span id="previewSenderNumber"></span><br>
            Email: <span id="previewSenderEmail"></span><br>
            ABN: <span id="previewSenderABN"></span>
          </p>

          <p class="h4 business-name" id="previewBusinessName"></p>
          <p>ABN: <span id="previewBusinessABN"></span><br>
            Phone: <span id="previewBusinessPhone"></span><br>
            Email: <span id="previewBusinessEmail"></span>
          </p>

          <p><strong>Invoice #</strong><span id="previewInvoiceNumber"></span><br>
            Date: <span id="previewInvoiceDate"></span>
          </p>

          <table class="table">
            <thead>
              <tr>
                <th>Product/Service</th>
                <th>Description</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="invoiceItems"></tbody>
          </table>

          <h5 class="text-right">Total: $<span id="totalAmount">0.00</span></h5>
        </div>
        <button class="btn btn-primary no-print mt-3" onclick="window.print()">Generate PDF</button>
      </div>
    </div>
  </div>

  <script>
    const inputIds = [
      "senderName", "senderNumber", "senderEmail", "senderABN",
      "businessName", "businessABN", "businessPhone", "businessEmail",
      "invoiceNumber", "invoiceDate"
    ];

    function updatePreview() {
      document.getElementById("previewSenderName").textContent = senderName.value;
      document.getElementById("previewSenderNumber").textContent = senderNumber.value;
      document.getElementById("previewSenderEmail").textContent = senderEmail.value;
      document.getElementById("previewSenderABN").textContent = senderABN.value;

      document.getElementById("previewBusinessName").textContent = businessName.value;
      document.getElementById("previewBusinessABN").textContent = businessABN.value;
      document.getElementById("previewBusinessPhone").textContent = businessPhone.value;
      document.getElementById("previewBusinessEmail").textContent = businessEmail.value;

      document.getElementById("previewInvoiceNumber").textContent = invoiceNumber.value;
      document.getElementById("previewInvoiceDate").textContent = invoiceDate.value;
    }

    inputIds.forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener("input", () => {
        updatePreview();
        saveToLocalStorage();
      });
    });

    function addService() {
      const name = document.getElementById("serviceName").value;
      const desc = document.getElementById("serviceDescription").value;
      const total = parseFloat(document.getElementById("serviceTotal").value).toFixed(2);

      if (!name || !desc || isNaN(total)) return;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${name}</td>
        <td>${desc}</td>
        <td>$${total}</td>
      `;
      document.getElementById("invoiceItems").appendChild(row);

      const totalAmount = document.getElementById("totalAmount");
      totalAmount.textContent = (parseFloat(totalAmount.textContent) + parseFloat(total)).toFixed(2);

      document.getElementById("services").innerHTML += `
        <div class="form-row">
          <div class="form-group col">
            <input type="text" class="form-control" value="${name}" readonly>
          </div>
          <div class="form-group col">
            <input type="text" class="form-control" value="${desc}" readonly>
          </div>
          <div class="form-group col">
            <input type="text" class="form-control" value="${total}" readonly>
          </div>
          <div class="form-group col-auto">
            <button class="btn btn-danger remove-btn" onclick="this.parentElement.parentElement.remove()">Remove</button>
          </div>
        </div>
      `;

      document.getElementById("serviceName").value = "";
      document.getElementById("serviceDescription").value = "";
      document.getElementById("serviceTotal").value = "";
    }

    function saveToLocalStorage() {
      inputIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          localStorage.setItem(id, el.value);
        }
      });
    }

    function loadFromLocalStorage() {
      inputIds.forEach(id => {
        const el = document.getElementById(id);
        if (el && localStorage.getItem(id)) {
          el.value = localStorage.getItem(id);
          el.dispatchEvent(new Event("input"));
        }
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadFromLocalStorage();
      updatePreview();
    });
  </script>
</body>
</html>
